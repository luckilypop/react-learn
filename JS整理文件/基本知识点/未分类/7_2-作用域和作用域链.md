# 一、函数的作用域

- **作用域（scope）**就是变量和函数的可访问范围，或者说**变量或函数起作用的区域**；
- 作用域是静态的(相对于上下文)，在编写代码时就确定了；
- 作用：隔离变量，不同作用下同名变量不会冲突；
- 产生作用域个数：N(定义几个函数) + 1(window)

## 1.1 全局作用域

- 全局作用域：变量和函数在整个程序中一直存在，所有地方都可以读取。

- 全局变量(global variable)：在函数外部声明的变量，它可以在函数内部读取

## 1.2 局部作用域

1. 局部作用域：变量和函数只在函数内部存在。在函数外部变量失效。 
2. 局部变量(local variable)：在函数内部定义的变量，外部无法读取。 
3. 在函数中，**参数也是局部变量**。 
4. 函数也有作用域，声明在外部的函数，可以任意位置调用，声明在函数内部的函数，一般只能在内部调用。 
5. **局部变量会在函数运行以后被删除。** 

6. **全局变量会在页面关闭后被删除。**

## 1.3 [ES6]块作用域

# 二、作用域和执行上下文

## 2.1 区别1

- 全局作用域之外，每个函数都会创建自己的作用域，==<font color = red > 作用域在函数定义</font>==时就已经确定了。而不是在函数调用时
- 全局执行上下文环境是在全局作用域确定之后, js代码马上执行之前创建
- 函数执行上下文是在调用函数时, 函数体代码执行之前创建

## 2.2 区别2

- 作用域是静态的, 只要函数定义好了就一直存在, 且不会再变化
- 执行上下文是动态的, 调用函数时创建, 函数调用结束时就会自动释放

## 2.3 联系

- 执行上下文(对象)是从属于所在的作用域
- 全局上下文环境\==>全局作用域
- 函数上下文环境\==>对应的函数使用域

# 三、作用域链

## 3.1 理解

- 多个上下级关系的作用域形成的链, 它的方向是从下向上的(从内到外)
- 查找变量时就是沿着作用域链来查找的

## 3.2 存在位置

- 在每个函数内部都有一个**[[Scope]]属性**，这个属性是不可以操作的。[看不到，获取不到，底层原理]
- 该属性指向了一个**集合**，这个集合中保存了**当前作用域下面变量对象的地址**，以及**上级作用域下面的变量对象的地址**；
- 这个集合就是作用域链；

## 3.3 查找规则

- 在当前作用域下的执行上下文中查找对应的属性, 如果有直接返回, 否则进入2

- 在上一级作用域的执行上下文中查找对应的属性, 如果有直接返回, 否则进入3

- 再次执行2的相同操作, 直到全局作用域, 如果还找不到就抛出找不到的异常

  ```js
  var a = 1
  function fn1() {
    var b = 2
    function fn2() {
      var c = 3
      console.log(c)
      console.log(b)
      console.log(a)
      console.log(d)
    }
    fn2()
  }
  fn1()
  ```

![image-20220727163533791](https://raw.githubusercontent.com/luckilypop/WebFront/main/js/images/202207271831854.png)

![image-20220727163838354](https://raw.githubusercontent.com/luckilypop/WebFront/main/js/images/202207271832121.png)

![image-20220727164226275](https://raw.githubusercontent.com/luckilypop/WebFront/main/js/images/202207271832613.png)